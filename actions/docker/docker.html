<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.101.0-DEV" />
<meta name="robots" content="index, follow">


<link rel="shortcut icon" href="/sh.wrap/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/sh.wrap/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/sh.wrap/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/sh.wrap/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/sh.wrap/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/sh.wrap/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/sh.wrap/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/sh.wrap/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/sh.wrap/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/sh.wrap/favicons/android-192x192.png" sizes="192x192">

<title>Docker images and scripts | sh.wrap</title>
<meta name="description" content="Docker image for sh.wrap testing Build docker image &amp;lt;&amp;lt;common-variables&amp;gt;&amp;gt; DOCKERFILE_TEMPLATE=&amp;#34;${DOCKERFILES_PATH}&amp;#34;/test-shellcheck.Dockerfile DOCKER_IMAGE=&amp;#34;shwrap:test-shellcheck&amp;#34; DOCKER_PATH=&amp;#34;${DOCKER_PATH}&amp;#34; DOCKERFILE=&amp;#34;${DOCKER_PATH}&amp;#34;/test-shellcheck.Dockerfile `ubuntu:latest` with `shellcheck` is a base image to run tests for sh.wrap.
FROM ubuntu:latest as build RUN apt update &amp;amp;&amp;amp; apt install --yes ca-certificates RUN apt install --yes bash RUN apt install --yes shellcheck FROM build COPY &amp;#34;${DOCKERFILE_SCRIPTS_PATH}&amp;#34;/entrypoint.sh entrypoint.sh ENTRYPOINT [&amp;#34;bash&amp;#34;, &amp;#34;/entrypoint.sh&amp;#34;] CMD [&amp;#34;${WORK_DIR}&amp;#34;, &amp;#34;${SCRIPT}&amp;#34;, &amp;#34;${ARGS}&amp;#34;] env -i \ DOCKERFILES_PATH=&amp;#34;${DOCKERFILES_PATH}&amp;#34; \ DOCKERFILE_SCRIPTS_PATH=&amp;#34;${DOCKERFILE_SCRIPTS_PATH}&amp;#34; \ bash &amp;#34;${DOCKERFILE_SCRIPTS_PATH}&amp;#34;/dockerfile.sh &amp;#34;${DOCKERFILE_TEMPLATE}&amp;#34; &amp;#34;${DOCKERFILE}&amp;#34; Build and tag an image.">
<meta property="og:title" content="Docker images and scripts" />
<meta property="og:description" content="Docker image for sh.wrap testing Build docker image &lt;&lt;common-variables&gt;&gt; DOCKERFILE_TEMPLATE=&#34;${DOCKERFILES_PATH}&#34;/test-shellcheck.Dockerfile DOCKER_IMAGE=&#34;shwrap:test-shellcheck&#34; DOCKER_PATH=&#34;${DOCKER_PATH}&#34; DOCKERFILE=&#34;${DOCKER_PATH}&#34;/test-shellcheck.Dockerfile `ubuntu:latest` with `shellcheck` is a base image to run tests for sh.wrap.
FROM ubuntu:latest as build RUN apt update &amp;&amp; apt install --yes ca-certificates RUN apt install --yes bash RUN apt install --yes shellcheck FROM build COPY &#34;${DOCKERFILE_SCRIPTS_PATH}&#34;/entrypoint.sh entrypoint.sh ENTRYPOINT [&#34;bash&#34;, &#34;/entrypoint.sh&#34;] CMD [&#34;${WORK_DIR}&#34;, &#34;${SCRIPT}&#34;, &#34;${ARGS}&#34;] env -i \ DOCKERFILES_PATH=&#34;${DOCKERFILES_PATH}&#34; \ DOCKERFILE_SCRIPTS_PATH=&#34;${DOCKERFILE_SCRIPTS_PATH}&#34; \ bash &#34;${DOCKERFILE_SCRIPTS_PATH}&#34;/dockerfile.sh &#34;${DOCKERFILE_TEMPLATE}&#34; &#34;${DOCKERFILE}&#34; Build and tag an image." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ekotik.github.io/sh.wrap/actions/docker/docker.html" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2022-10-26T05:20:14+03:00" />
<meta property="article:modified_time" content="2022-10-26T05:20:14+03:00" />

<meta itemprop="name" content="Docker images and scripts">
<meta itemprop="description" content="Docker image for sh.wrap testing Build docker image &lt;&lt;common-variables&gt;&gt; DOCKERFILE_TEMPLATE=&#34;${DOCKERFILES_PATH}&#34;/test-shellcheck.Dockerfile DOCKER_IMAGE=&#34;shwrap:test-shellcheck&#34; DOCKER_PATH=&#34;${DOCKER_PATH}&#34; DOCKERFILE=&#34;${DOCKER_PATH}&#34;/test-shellcheck.Dockerfile `ubuntu:latest` with `shellcheck` is a base image to run tests for sh.wrap.
FROM ubuntu:latest as build RUN apt update &amp;&amp; apt install --yes ca-certificates RUN apt install --yes bash RUN apt install --yes shellcheck FROM build COPY &#34;${DOCKERFILE_SCRIPTS_PATH}&#34;/entrypoint.sh entrypoint.sh ENTRYPOINT [&#34;bash&#34;, &#34;/entrypoint.sh&#34;] CMD [&#34;${WORK_DIR}&#34;, &#34;${SCRIPT}&#34;, &#34;${ARGS}&#34;] env -i \ DOCKERFILES_PATH=&#34;${DOCKERFILES_PATH}&#34; \ DOCKERFILE_SCRIPTS_PATH=&#34;${DOCKERFILE_SCRIPTS_PATH}&#34; \ bash &#34;${DOCKERFILE_SCRIPTS_PATH}&#34;/dockerfile.sh &#34;${DOCKERFILE_TEMPLATE}&#34; &#34;${DOCKERFILE}&#34; Build and tag an image."><meta itemprop="datePublished" content="2022-10-26T05:20:14+03:00" />
<meta itemprop="dateModified" content="2022-10-26T05:20:14+03:00" />
<meta itemprop="wordCount" content="3639">
<meta itemprop="keywords" content="development," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Docker images and scripts"/>
<meta name="twitter:description" content="Docker image for sh.wrap testing Build docker image &lt;&lt;common-variables&gt;&gt; DOCKERFILE_TEMPLATE=&#34;${DOCKERFILES_PATH}&#34;/test-shellcheck.Dockerfile DOCKER_IMAGE=&#34;shwrap:test-shellcheck&#34; DOCKER_PATH=&#34;${DOCKER_PATH}&#34; DOCKERFILE=&#34;${DOCKER_PATH}&#34;/test-shellcheck.Dockerfile `ubuntu:latest` with `shellcheck` is a base image to run tests for sh.wrap.
FROM ubuntu:latest as build RUN apt update &amp;&amp; apt install --yes ca-certificates RUN apt install --yes bash RUN apt install --yes shellcheck FROM build COPY &#34;${DOCKERFILE_SCRIPTS_PATH}&#34;/entrypoint.sh entrypoint.sh ENTRYPOINT [&#34;bash&#34;, &#34;/entrypoint.sh&#34;] CMD [&#34;${WORK_DIR}&#34;, &#34;${SCRIPT}&#34;, &#34;${ARGS}&#34;] env -i \ DOCKERFILES_PATH=&#34;${DOCKERFILES_PATH}&#34; \ DOCKERFILE_SCRIPTS_PATH=&#34;${DOCKERFILE_SCRIPTS_PATH}&#34; \ bash &#34;${DOCKERFILE_SCRIPTS_PATH}&#34;/dockerfile.sh &#34;${DOCKERFILE_TEMPLATE}&#34; &#34;${DOCKERFILE}&#34; Build and tag an image."/>




<link rel="preload" href="/sh.wrap/scss/main.min.def2cdda5cfcd95d9660c969a68946395435ad5fc75402be473d9995c7e926b3.css" as="style">
<link href="/sh.wrap/scss/main.min.def2cdda5cfcd95d9660c969a68946395435ad5fc75402be473d9995c7e926b3.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>

  </head>
  <body class="td-page">
    <header>
      <nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
  <a class="navbar-brand" href="/sh.wrap/"><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="navbar-brand__name">sh.wrap</span></a>
  <div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
    <ul class="navbar-nav mt-2 mt-lg-0">
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link active" href="/sh.wrap/docs/"><span class="active">Documentation</span></a>
      </li>
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link active" href="/sh.wrap/docs/dev/"><span class="active">Development</span></a>
      </li>
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link" href="/sh.wrap/wiki/"><span>Wiki</span></a>
      </li>
      </ul>
  </div>
  <div class="navbar-nav d-none d-lg-block">
    
  </div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            
<div id="td-sidebar-menu" class="td-sidebar__inner">
  <div id="content-mobile">
  <form class="td-sidebar__search d-flex align-items-center">
    
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-section-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  </div>
  <div id="content-desktop"></div>
  <nav class="collapse td-sidebar-nav" id="td-section-nav">
    <ul class="td-sidebar-nav__section pr-md-3 ul-0">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-shwrapdocs-li">
  <a href="/sh.wrap/docs/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-shwrapdocs"><span class="">Documentation</span></a>
  <ul class="ul-1">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-shwrapproject-li">
  <a href="/sh.wrap/project/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-shwrapproject"><span class="">Project documentation</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-shwrapprojecttodotodohtml-li">
  <a href="/sh.wrap/project/todo/todo.html" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-shwrapprojecttodotodohtml"><span class="">Pool of tasks</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-shwrapprojectmilestonemilestonehtml-li">
  <a href="/sh.wrap/project/milestone/milestone.html" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-shwrapprojectmilestonemilestonehtml"><span class="">Milestones</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-shwrapprojectroadmaproadmaphtml-li">
  <a href="/sh.wrap/project/roadmap/roadmap.html" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-shwrapprojectroadmaproadmaphtml"><span class="">Roadmap</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-shwrapdocsdev-li">
  <a href="/sh.wrap/docs/dev/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-shwrapdocsdev"><span class="">Development documentation</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-shwrapactions-li">
  <a href="/sh.wrap/actions/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-shwrapactions"><span class="">GH actions</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id="m-shwrapactionsdockerdockerhtml-li">
  <a href="/sh.wrap/actions/docker/docker.html" class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id="m-shwrapactionsdockerdockerhtml"><span class="td-sidebar-nav-active-item">Docker images and scripts</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-shwrapdocsdevdocscommonsh-li">
  <a href="/sh.wrap/docs/dev/docs/common.sh/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-shwrapdocsdevdocscommonsh"><span class=""></span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-shwrapdocsdevdocsimportsh-li">
  <a href="/sh.wrap/docs/dev/docs/import.sh/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-shwrapdocsdevdocsimportsh"><span class=""></span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-shwrapdocsdevdocsinitsh-li">
  <a href="/sh.wrap/docs/dev/docs/init.sh/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-shwrapdocsdevdocsinitsh"><span class=""></span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-shwrapdocsdevdocsmodulesh-li">
  <a href="/sh.wrap/docs/dev/docs/module.sh/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-shwrapdocsdevdocsmodulesh"><span class=""></span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-shwrapdocsdevdocsrunsh-li">
  <a href="/sh.wrap/docs/dev/docs/run.sh/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-shwrapdocsdevdocsrunsh"><span class=""></span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-shwrapdocsdevdocssearchsh-li">
  <a href="/sh.wrap/docs/dev/docs/search.sh/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-shwrapdocsdevdocssearchsh"><span class=""></span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-shwrapdocsdevdocsutilsh-li">
  <a href="/sh.wrap/docs/dev/docs/util.sh/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-shwrapdocsdevdocsutilsh"><span class=""></span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-shwrapdocsuser-li">
  <a href="/sh.wrap/docs/user/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-shwrapdocsuser"><span class="">User documentation</span></a>
</li>
  </ul>
</li>
    </ul>
  </nav>
</div>

          </aside>
          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">

</div>

            <div class="td-toc">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#docker-image-for-shwrap-testing">Docker image for sh.wrap testing</a>
      <ul>
        <li><a href="#build-docker-image">Build docker image</a></li>
        <li><a href="#test-runner">Test runner</a></li>
        <li><a href="#run">Run</a></li>
      </ul>
    </li>
    <li><a href="#docker-image-for-go-build">Docker image for go build</a>
      <ul>
        <li><a href="#build-docker-image-1">Build docker image</a></li>
        <li><a href="#go-build">Go build</a></li>
        <li><a href="#run-1">Run</a></li>
      </ul>
    </li>
    <li><a href="#docker-image-for-documentation-conversions">Docker image for documentation conversions</a>
      <ul>
        <li><a href="#build-docker-image-2">Build docker image</a></li>
        <li><a href="#convert-org-to-markdown">Convert org to markdown</a></li>
        <li><a href="#run-2">Run</a></li>
      </ul>
    </li>
    <li><a href="#docker-image-for-documentation-site-generation">Docker image for documentation site generation</a>
      <ul>
        <li><a href="#build-docker-image-3">Build docker image</a></li>
        <li><a href="#hugo-site">Hugo site</a></li>
        <li><a href="#run-3">Run</a></li>
      </ul>
    </li>
    <li><a href="#docker-image-for-git-tasks">Docker image for git tasks</a>
      <ul>
        <li><a href="#build-docker-image-4">Build docker image</a></li>
        <li><a href="#git-tasks">Git tasks</a></li>
        <li><a href="#gh-publish">GH publish</a></li>
        <li><a href="#git-submodules-update">Git submodules update</a></li>
        <li><a href="#run-4">Run</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </div>
    
            

	
		



  
  

	
		



  
  
    <div class="taxonomy taxonomy-terms-cloud taxo-tags">
      
        <h5 class="taxonomy-title">Tags</h5>
      
      <ul class="taxonomy-terms">
        
          <li><a class="taxonomy-term" href="https://ekotik.github.io/sh.wrap/tags/devdocs/" data-taxonomy-term="devdocs"><span class="taxonomy-label">devdocs</span><span class="taxonomy-count">1</span></a></li>
        
          <li><a class="taxonomy-term" href="https://ekotik.github.io/sh.wrap/tags/development/" data-taxonomy-term="development"><span class="taxonomy-label">development</span><span class="taxonomy-count">8</span></a></li>
        
          <li><a class="taxonomy-term" href="https://ekotik.github.io/sh.wrap/tags/docs/" data-taxonomy-term="docs"><span class="taxonomy-label">docs</span><span class="taxonomy-count">3</span></a></li>
        
          <li><a class="taxonomy-term" href="https://ekotik.github.io/sh.wrap/tags/milestone/" data-taxonomy-term="milestone"><span class="taxonomy-label">milestone</span><span class="taxonomy-count">2</span></a></li>
        
          <li><a class="taxonomy-term" href="https://ekotik.github.io/sh.wrap/tags/project/" data-taxonomy-term="project"><span class="taxonomy-label">project</span><span class="taxonomy-count">4</span></a></li>
        
          <li><a class="taxonomy-term" href="https://ekotik.github.io/sh.wrap/tags/roadmap/" data-taxonomy-term="roadmap"><span class="taxonomy-label">roadmap</span><span class="taxonomy-count">1</span></a></li>
        
          <li><a class="taxonomy-term" href="https://ekotik.github.io/sh.wrap/tags/task/" data-taxonomy-term="task"><span class="taxonomy-label">task</span><span class="taxonomy-count">1</span></a></li>
        
          <li><a class="taxonomy-term" href="https://ekotik.github.io/sh.wrap/tags/wiki/" data-taxonomy-term="wiki"><span class="taxonomy-label">wiki</span><span class="taxonomy-count">2</span></a></li>
        
      </ul>
    </div>
  

	

          </aside>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="td-breadcrumbs">
  <ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="https://ekotik.github.io/sh.wrap/docs/">Documentation</a>
  </li>
  <li class="breadcrumb-item">
    <a href="https://ekotik.github.io/sh.wrap/docs/dev/">Development documentation</a>
  </li>
  <li class="breadcrumb-item">
    <a href="https://ekotik.github.io/sh.wrap/actions/">GH actions</a>
  </li>
  <li class="breadcrumb-item active" aria-current="page">
    <a href="https://ekotik.github.io/sh.wrap/actions/docker/docker.html" aria-disabled="true" class="btn-link disabled">Docker images and scripts</a>
  </li>
  </ol>
</nav>
            
<div class="td-content">
	<h1>Docker images and scripts</h1>
	
	<header class="article-meta">
		

  
    


  
    


<div class="taxonomy taxonomy-terms-article taxo-tags">
  <h5 class="taxonomy-title">Tags:</h5>
  <ul class="taxonomy-terms">
    
      <li><a class="taxonomy-term" href="https://ekotik.github.io/sh.wrap/tags/development/" data-taxonomy-term="development"><span class="taxonomy-label">development</span></a></li>
    
  </ul>
</div>

  

		
	</header>    
	<h1 id="docker-image-for-shwrap-testing">Docker image for sh.wrap testing</h1>
<h2 id="build-docker-image">Build docker image</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&lt;&lt;common-variables&gt;&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>DOCKERFILE_TEMPLATE=&#34;${DOCKERFILES_PATH}&#34;/test-shellcheck.Dockerfile
</span></span><span style="display:flex;"><span>DOCKER_IMAGE=&#34;shwrap:test-shellcheck&#34;
</span></span><span style="display:flex;"><span>DOCKER_PATH=&#34;${DOCKER_PATH}&#34;
</span></span><span style="display:flex;"><span>DOCKERFILE=&#34;${DOCKER_PATH}&#34;/test-shellcheck.Dockerfile
</span></span></code></pre></div><p>`ubuntu:latest` with `shellcheck` is a base image to run tests for sh.wrap.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>FROM ubuntu:latest as build
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>RUN apt update &amp;&amp; apt install --yes ca-certificates
</span></span><span style="display:flex;"><span>RUN apt install --yes bash
</span></span><span style="display:flex;"><span>RUN apt install --yes shellcheck
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FROM build
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>COPY &#34;${DOCKERFILE_SCRIPTS_PATH}&#34;/entrypoint.sh entrypoint.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ENTRYPOINT [&#34;bash&#34;, &#34;/entrypoint.sh&#34;]
</span></span><span style="display:flex;"><span>CMD [&#34;${WORK_DIR}&#34;, &#34;${SCRIPT}&#34;, &#34;${ARGS}&#34;]
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>env -i <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    <span style="color:#000">DOCKERFILES_PATH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILES_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    <span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/dockerfile.sh <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_TEMPLATE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><p>Build and tag an image.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>docker build -t &#34;${DOCKER_IMAGE}&#34; -f &#34;${DOCKERFILE}&#34; &#34;${DOCKER_PATH}&#34; --no-cache
</span></span><span style="display:flex;"><span>docker tag &#34;${DOCKER_IMAGE}&#34; &#34;${DOCKER_REPO}&#34;/&#34;${DOCKER_IMAGE}&#34;
</span></span></code></pre></div><p>Push to Docker Hub (optionally).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker push <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h2 id="test-runner">Test runner</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#000">LIVE_OR_DIE</span><span style="color:#ce5c00;font-weight:bold">=</span>live
</span></span><span style="display:flex;"><span><span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;preamble&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;op</span>tions&gt;&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;optio</span>ns-debug&gt;&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;help&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;live-or-die-trap&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;gh</span>-mode&gt;&gt;
</span></span></code></pre></div><p>Help.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>help-test<span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">printf</span> <span style="color:#4e9a06">&#34;Usage: %s: &lt;SRCDIR...&gt;&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$0</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">help</span> <span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># greetings for github runner</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::notice::Shellcheck action started!&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><p>Set up parameters.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#000">dirs</span><span style="color:#ce5c00;font-weight:bold">=(</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span></code></pre></div><p>Check parameters.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#000">$#</span> -eq <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> &gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">&#34;No source directories specified&#34;</span>
</span></span><span style="display:flex;"><span>    help-test <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">declare</span> -a <span style="color:#204a87">dirs</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_mode</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    readarray -t -d <span style="color:#4e9a06">$&#39;\n&#39;</span> <span style="color:#204a87">dirs</span> &lt; &lt;<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87">echo</span> -e <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dirs</span><span style="color:#ce5c00;font-weight:bold">+=(</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::group::Shellcheck action&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><p>Scan for shell scripts.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># scan for `sh` files in specified directories</span>
</span></span><span style="display:flex;"><span><span style="color:#000">files</span><span style="color:#ce5c00;font-weight:bold">=()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">for</span> src_dir in <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">dirs</span><span style="color:#000;font-weight:bold">[@]</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">while</span> <span style="color:#000">IFS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">$&#39;\0&#39;</span> <span style="color:#204a87">read</span> -d <span style="color:#4e9a06">$&#39;\0&#39;</span> -r src_file<span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">files</span><span style="color:#ce5c00;font-weight:bold">+=(</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$src_file</span><span style="color:#4e9a06">&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">done</span> &lt; &lt;<span style="color:#ce5c00;font-weight:bold">(</span>find ./<span style="color:#4e9a06">&#34;</span><span style="color:#000">$src_dir</span><span style="color:#4e9a06">&#34;</span> -name <span style="color:#4e9a06">&#39;*.sh&#39;</span> -print0<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">done</span>
</span></span></code></pre></div><p>Shellcheck run.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># run shellcheck</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;no shell scripts for checking are found&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${#</span><span style="color:#000">files</span><span style="color:#000;font-weight:bold">[@]</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> !<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ret</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span> shellcheck -f gcc <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">files</span><span style="color:#000;font-weight:bold">[@]</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> &gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>           <span style="color:#204a87">echo</span> <span style="color:#000">$?</span> <span style="color:#204a87;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span> 3&gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">1</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::endgroup::&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#000">$ret</span> !<span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::error::Shellcheck failed&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::notice::Shellcheck passed&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># goodbye</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::notice::Shellcheck action ended!&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#204a87">exit</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$ret</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h2 id="run">Run</h2>
<p>Authentication token for github.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#204a87">read</span> -s -p <span style="color:#4e9a06">&#39;Enter token: &#39;</span> gh_token
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;common-variables&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;doc</span>kerfile-test&gt;&gt;
</span></span></code></pre></div><h3 id="run-script">Run script</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">script</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test-shellcheck.sh
</span></span><span style="display:flex;"><span><span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=(</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/src<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>env -i <span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#204a87;font-weight:bold">$(</span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">args</span><span style="color:#000;font-weight:bold">[@]</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>env -i <span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000">LIVE_OR_DIE</span><span style="color:#ce5c00;font-weight:bold">=</span>live <span style="color:#000">GH_MODE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">$(</span><span style="color:#204a87">printf</span> <span style="color:#4e9a06">&#39;%s\n&#39;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">args</span><span style="color:#000;font-weight:bold">[@]</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h3 id="run-docker">Run docker</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">work_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/github/workspace&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">script</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span>/src/test-shellcheck.sh
</span></span><span style="display:flex;"><span><span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;test&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker run -it --rm --name shwrap-test <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       --volume <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>:<span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       -eLIVE_DEBUG<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$args</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">=(</span><span style="color:#204a87">test</span> src<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker run -it --rm --name shwrap-test <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       --volume <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>:<span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       -eLIVE_DEBUG<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> -eLIVE_OR_DIE<span style="color:#ce5c00;font-weight:bold">=</span>live -eGH_MODE<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">$(</span><span style="color:#204a87">printf</span> <span style="color:#4e9a06">&#39;%s\n&#39;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$args</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h3 id="run-action">Run action</h3>
<h4 id="template">Template</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.json" data-lang="{.json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${REF}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;inputs&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;run_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${RUN_ID}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;payload&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;dockerfile_template&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${DOCKERFILE_TEMPLATE}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;dockerfile&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${DOCKERFILE}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;work_dir&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${WORK_DIR}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;script&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${SCRIPT}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;args&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${ARGS}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="data">Data</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#8f5902;font-style:italic"># shellcheck disable=SC2034</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">WORKFLOW_ID</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;38942438&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">REF</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;actions&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">RUN_ID</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;test-shellcheck/01/01&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">DOCKERFILE_TEMPLATE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./_actions/docker/test-shellcheck.Dockerfile&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">DOCKERFILE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;test-shellcheck.Dockerfile&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">WORK_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/github/workspace/_actions&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">SCRIPT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./src/test-shellcheck.sh&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">ARGS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./src&#34;</span>
</span></span></code></pre></div><h4 id="test">Test</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">GITHUB_REPO</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;ekotik/sh.wrap&#34;</span>
</span></span><span style="display:flex;"><span>env <span style="color:#000">GITHUB_TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/workflow/test-workflows.sh <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">GITHUB_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/workflow/data/test-shellcheck
</span></span></code></pre></div><h1 id="docker-image-for-go-build">Docker image for go build</h1>
<h2 id="build-docker-image-1">Build docker image</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&lt;&lt;common-variables&gt;&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>DOCKERFILE_TEMPLATE=&#34;${DOCKERFILES_PATH}&#34;/go-build.Dockerfile
</span></span><span style="display:flex;"><span>DOCKER_IMAGE=&#34;shwrap:go-build&#34;
</span></span><span style="display:flex;"><span>DOCKER_PATH=&#34;${DOCKER_PATH}&#34;
</span></span><span style="display:flex;"><span>DOCKERFILE=&#34;${DOCKER_PATH}&#34;/go-build.Dockerfile
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>FROM ubuntu:latest as build
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>RUN apt update &amp;&amp; apt install --yes ca-certificates
</span></span><span style="display:flex;"><span>RUN apt install --yes bash
</span></span><span style="display:flex;"><span>RUN apt install --yes git
</span></span><span style="display:flex;"><span>RUN apt install --yes golang
</span></span><span style="display:flex;"><span>RUN apt install --yes make
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FROM build as hugo-build
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>COPY &#34;${DOCKERFILE_SCRIPTS_PATH}&#34;/entrypoint.sh /entrypoint.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ENTRYPOINT [&#34;bash&#34;, &#34;/entrypoint.sh&#34;]
</span></span><span style="display:flex;"><span>CMD [&#34;${WORK_DIR}&#34;, &#34;${SCRIPT}&#34;, &#34;${GIT_PATH}&#34;, &#34;${GIT_REPO}&#34;, &#34;${ARGS}&#34;]
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>env -i <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    <span style="color:#000">DOCKERFILES_PATH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILES_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    <span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/dockerfile.sh <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_TEMPLATE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker build -t <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> -f <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> --no-cache
</span></span><span style="display:flex;"><span>docker tag <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><p>Push to Docker Hub (optionally).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker push <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h2 id="go-build">Go build</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#000">LIVE_OR_DIE</span><span style="color:#ce5c00;font-weight:bold">=</span>live
</span></span><span style="display:flex;"><span><span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;preamble&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;op</span>tions&gt;&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;optio</span>ns-debug&gt;&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;help&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;live-or-die-trap&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;git-trap&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;cd-trap&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;gh</span>-mode&gt;&gt;
</span></span></code></pre></div><p>Help.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>help-go-build<span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">printf</span> <span style="color:#4e9a06">&#34;Usage: %s: &lt;GITPATH&gt; &lt;GITREPO&gt; &lt;GITHASH&gt; [BUILDARGS...]\n&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$0</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">help</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># greetings for github runner</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::notice::Go build action started!&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><p>Set up parameters.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#000">git_path</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_repo</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/gohugoio/hugo&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_hash</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;bfebd8c02cfc0d4e4786e0f64932d832d3976e92&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">build_args</span><span style="color:#ce5c00;font-weight:bold">=(</span>--tags extended<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span></code></pre></div><p>Check parameters.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># check parameters</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#000">$#</span> -eq <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> &gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">&#34;No git repository destination specified&#34;</span>
</span></span><span style="display:flex;"><span>    help-go-build <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#000">$#</span> -eq <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> &gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">&#34;No git repository url specified&#34;</span>
</span></span><span style="display:flex;"><span>    help-go-build <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#000">$#</span> -eq <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> &gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">&#34;No git commit hash specified&#34;</span>
</span></span><span style="display:flex;"><span>    help-go-build <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># check working directory</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_path</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>realpath <span style="color:#4e9a06">&#34;</span><span style="color:#000">$1</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_repo</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$2</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_hash</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$3</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">shift</span> <span style="color:#0000cf;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">declare</span> -a build_args
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_mode</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    readarray -t -d <span style="color:#4e9a06">$&#39;\n&#39;</span> build_args &lt; &lt;<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87">echo</span> -e <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">build_args</span><span style="color:#ce5c00;font-weight:bold">+=(</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;working directory is invalid&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[[</span> -d <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_path</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span></code></pre></div><p>Set up hugo parameters.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">git_repo_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>realpath <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_path</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">git_repo</span><span style="color:#000;font-weight:bold">##*/</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GOPATH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo_dir</span><span style="color:#4e9a06">&#34;</span>/.go
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GOCACHE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo_dir</span><span style="color:#4e9a06">&#34;</span>/.cache
</span></span></code></pre></div><p>Clone and configure repository.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::group::Clone repository&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;git repository safe.directory configuration failed&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># fixes go build with -buildvcs option in unsafe git directories</span>
</span></span><span style="display:flex;"><span><span style="color:#000">GIT_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span>.nogit git config --global --add safe.directory <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># clone go repo</span>
</span></span><span style="display:flex;"><span>mkdir -p <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span>git -C <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo_dir</span><span style="color:#4e9a06">&#34;</span> init <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span>git -C <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo_dir</span><span style="color:#4e9a06">&#34;</span> remote add origin <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span>git -C <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo_dir</span><span style="color:#4e9a06">&#34;</span> pull --depth<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> origin <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_hash</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::endgroup::&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><p>Build go binary.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::group::Build go binary&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># build hugo</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;change directory to &#39;</span><span style="color:#4e9a06">${</span><span style="color:#000">git_repo_dir</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#39; failed&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">pushd</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;go build failed&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> -f Makefile <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>        make -k -B
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>        go build -ldflags <span style="color:#4e9a06">&#34;-s -w&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">build_args</span><span style="color:#000;font-weight:bold">[@]</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">popd</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::endgroup::&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># goodbye</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::notice::Go build action ended!&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><h2 id="run-1">Run</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;common-variables&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;doc</span>kerfile-go-build&gt;&gt;
</span></span></code></pre></div><p>Authentication token for github.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#204a87">read</span> -s -p <span style="color:#4e9a06">&#39;Enter token: &#39;</span> gh_token
</span></span></code></pre></div><h3 id="run-hugo-build">Run hugo build</h3>
<h4 id="run-script-1">Run script</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">script</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/go-build.sh
</span></span><span style="display:flex;"><span><span style="color:#000">git_path</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_repo</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/gohugoio/hugo&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_hash</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;bfebd8c02cfc0d4e4786e0f64932d832d3976e92&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">build_args</span><span style="color:#ce5c00;font-weight:bold">=(</span>--tags extended<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>env <span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_path</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_hash</span><span style="color:#4e9a06">&#34;</span> <span style="color:#204a87;font-weight:bold">$(</span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">build_args</span><span style="color:#000;font-weight:bold">[@]</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>env <span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000">LIVE_OR_DIE</span><span style="color:#ce5c00;font-weight:bold">=</span>live <span style="color:#000">GH_MODE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_path</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_hash</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">$(</span><span style="color:#204a87">printf</span> <span style="color:#4e9a06">&#39;%s\n&#39;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">build_args</span><span style="color:#000;font-weight:bold">[@]</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h4 id="run-docker-1">Run docker</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">work_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/github/workspace&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">script</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span>/src/go-build.sh
</span></span><span style="display:flex;"><span><span style="color:#000">git_path</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span>/docker
</span></span><span style="display:flex;"><span><span style="color:#000">git_repo</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/gohugoio/hugo&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_hash</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;bfebd8c02cfc0d4e4786e0f64932d832d3976e92&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">build_args</span><span style="color:#ce5c00;font-weight:bold">=(</span>--tags extended<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker run -it --rm --name shwrap-hugo-build <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       --volume <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>:<span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       -eLIVE_DEBUG<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_path</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_hash</span><span style="color:#4e9a06">&#34;</span> <span style="color:#204a87;font-weight:bold">$(</span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">build_args</span><span style="color:#000;font-weight:bold">[@]</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker run -it --rm --name shwrap-hugo-build <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       --volume <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>:<span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       -eLIVE_DEBUG<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> -eLIVE_OR_DIE<span style="color:#ce5c00;font-weight:bold">=</span>live -eGH_MODE<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_path</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_hash</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">$(</span><span style="color:#204a87">printf</span> <span style="color:#4e9a06">&#39;%s\n&#39;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">build_args</span><span style="color:#000;font-weight:bold">[@]</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h3 id="run-gh-build">Run gh build</h3>
<h4 id="run-script-2">Run script</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">script</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/go-build.sh
</span></span><span style="display:flex;"><span><span style="color:#000">git_path</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_repo</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/cli/cli&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_hash</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;7d71f807c48600d0d8d9f393ef13387504987f1d&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>env <span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_path</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_hash</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>env <span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000">LIVE_OR_DIE</span><span style="color:#ce5c00;font-weight:bold">=</span>live <span style="color:#000">GH_MODE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_path</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_hash</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h4 id="run-docker-2">Run docker</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;common-variables&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;doc</span>kerfile-go-build&gt;&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">work_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/github/workspace&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">script</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span>/src/go-build.sh
</span></span><span style="display:flex;"><span><span style="color:#000">git_path</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span>/docker
</span></span><span style="display:flex;"><span><span style="color:#000">git_repo</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/cli/cli&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_hash</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;7d71f807c48600d0d8d9f393ef13387504987f1d&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker run -it --rm --name shwrap-gh-build <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       --volume <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>:<span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       -eLIVE_DEBUG<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_path</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_hash</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker run -it --rm --name shwrap-gh-build <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       --volume <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>:<span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       -eLIVE_DEBUG<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> -eLIVE_OR_DIE<span style="color:#ce5c00;font-weight:bold">=</span>live -eGH_MODE<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_path</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_hash</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h4 id="run-action-1">Run action</h4>
<ol>
<li>
<p>Template</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.json" data-lang="{.json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${REF}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;inputs&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;run_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${RUN_ID}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;payload&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;dockerfile_template&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${DOCKERFILE_TEMPLATE}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;dockerfile&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${DOCKERFILE}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;work_dir&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${WORK_DIR}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;script&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${SCRIPT}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;git_path&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GIT_PATH}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;git_repo&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GIT_REPO}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;git_hash&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GIT_HASH}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;build_args&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${BUILD_ARGS}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;go_bin&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GO_BIN}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;use_cache&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#a40000">$</span><span style="color:#000;font-weight:bold">{</span><span style="color:#a40000">USE_CACHE</span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div></li>
<li>
<p>Data</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#8f5902;font-style:italic"># shellcheck disable=SC2034</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">WORKFLOW_ID</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;38942439&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">REF</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;actions&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">RUN_ID</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;go-build/01/01&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">DOCKERFILE_TEMPLATE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./_actions/docker/go-build.Dockerfile&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">DOCKERFILE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;go-build.Dockerfile&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">WORK_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/github/workspace&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">SCRIPT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./_actions/src/go-build.sh&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GIT_PATH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GIT_REPO</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/cli/cli&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GIT_HASH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;7d71f807c48600d0d8d9f393ef13387504987f1d&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">BUILD_ARGS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GO_BIN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./cli/bin&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">USE_CACHE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span>
</span></span></code></pre></div></li>
<li>
<p>Test</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">GITHUB_REPO</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;ekotik/sh.wrap&#34;</span>
</span></span><span style="display:flex;"><span>env <span style="color:#000">GITHUB_TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/workflow/test-workflows.sh <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">GITHUB_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/workflow/data/go-build
</span></span></code></pre></div></li>
</ol>
<h1 id="docker-image-for-documentation-conversions">Docker image for documentation conversions</h1>
<h2 id="build-docker-image-2">Build docker image</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&lt;&lt;common-variables&gt;&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>DOCKERFILE_TEMPLATE=&#34;${DOCKERFILES_PATH}&#34;/pandoc-convert.Dockerfile
</span></span><span style="display:flex;"><span>DOCKER_IMAGE=&#34;shwrap:pandoc-convert&#34;
</span></span><span style="display:flex;"><span>DOCKER_PATH=&#34;${DOCKER_PATH}&#34;
</span></span><span style="display:flex;"><span>DOCKERFILE=&#34;${DOCKER_PATH}&#34;/pandoc-convert.Dockerfile
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>FROM ubuntu:latest as build
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>RUN apt update &amp;&amp; apt install --yes ca-certificates
</span></span><span style="display:flex;"><span>RUN apt install --yes bash
</span></span><span style="display:flex;"><span>RUN apt install --yes pandoc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FROM build as pandoc-convert
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>COPY &#34;${DOCKERFILE_SCRIPTS_PATH}&#34;/entrypoint.sh /entrypoint.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ENTRYPOINT [&#34;bash&#34;, &#34;/entrypoint.sh&#34;]
</span></span><span style="display:flex;"><span>CMD [&#34;${WORK_DIR}&#34;, &#34;${SCRIPT}&#34;, &#34;${ARGS}&#34;]
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>env -i <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    <span style="color:#000">DOCKERFILES_PATH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILES_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    <span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/dockerfile.sh <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_TEMPLATE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker build -t <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> -f <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> --no-cache
</span></span><span style="display:flex;"><span>docker tag <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><p>Push to Docker Hub (optionally).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker push <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h2 id="convert-org-to-markdown">Convert org to markdown</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;preamble&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;op</span>tions&gt;&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;optio</span>ns-debug&gt;&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;help&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;live-or-die-trap&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;gh</span>-mode&gt;&gt;
</span></span></code></pre></div><p>Parameters.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#000">in_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>realpath <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/doc<span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">out_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>realpath <span style="color:#4e9a06">&#34;./.doc-out&#34;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">clean</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span>
</span></span></code></pre></div><p>Help and parameters check.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>help-org-to-md<span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">printf</span> <span style="color:#4e9a06">&#34;Usage: %s: &lt;INDIR&gt; &lt;OUTDIR&gt; [CLEAN]\n&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$0</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">help</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># check source directory</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#000">$#</span> -eq <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> &gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">&#34;No source directory specified&#34;</span>
</span></span><span style="display:flex;"><span>    help-org-to-md <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># check destination directory</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#000">$#</span> -eq <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> &gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">&#34;No destination directory specified&#34;</span>
</span></span><span style="display:flex;"><span>    help-org-to-md <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">in_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>realpath <span style="color:#4e9a06">&#34;</span><span style="color:#000">$1</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">out_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>realpath -m <span style="color:#4e9a06">&#34;</span><span style="color:#000">$2</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">clean</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$3</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><p>Conversion function.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>function org_to_md()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    local page=&#34;$1&#34;
</span></span><span style="display:flex;"><span>    local clean=&#34;$2&#34;
</span></span><span style="display:flex;"><span>    local extensions=&#34;&#34;
</span></span><span style="display:flex;"><span>    if [[ &#34;$clean&#34; == 1 ]]; then
</span></span><span style="display:flex;"><span>        extensions=&#34;-raw_attribute-raw_html-header_attributes-bracketed_spans&#34;
</span></span><span style="display:flex;"><span>    fi
</span></span><span style="display:flex;"><span>    extensions+=&#34;+hard_line_breaks&#34;
</span></span><span style="display:flex;"><span>    extensions+=&#34;-yaml_metadata_block-pandoc_title_block&#34;
</span></span><span style="display:flex;"><span>    pandoc -s &#34;$page&#34; -t markdown&#34;$extensions&#34; --wrap=none
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># greetings for github runner</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::notice::Pandoc conversion action started!&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><p>Conversion.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># generate documentation</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::group::Convert docs&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span><span style="display:flex;"><span><span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;conversion failed&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">while</span> <span style="color:#000">IFS</span><span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">read</span> -d <span style="color:#4e9a06">$&#39;\0&#39;</span> -r path<span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>dirname <span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">$(</span>realpath -m -s <span style="color:#4e9a06">&#34;</span><span style="color:#000">$path</span><span style="color:#4e9a06">&#34;</span> --relative-base <span style="color:#4e9a06">&#34;</span><span style="color:#000">$in_dir</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">file</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>basename <span style="color:#4e9a06">&#34;</span><span style="color:#000">$path</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    mkdir -p <span style="color:#4e9a06">&#34;</span><span style="color:#000">$out_dir</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#000">$dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#204a87">true</span> 2&gt; /dev/null
</span></span><span style="display:flex;"><span>    org_to_md <span style="color:#4e9a06">&#34;</span><span style="color:#000">$in_dir</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#000">$dir</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#000">$file</span><span style="color:#4e9a06">&#34;</span> <span style="color:#0000cf;font-weight:bold">1</span> &gt; <span style="color:#4e9a06">&#34;</span><span style="color:#000">$out_dir</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#000">$dir</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">file</span><span style="color:#000;font-weight:bold">%.org</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">.md&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>        <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">done</span> &lt; &lt;<span style="color:#ce5c00;font-weight:bold">(</span>find <span style="color:#4e9a06">&#34;</span><span style="color:#000">$in_dir</span><span style="color:#4e9a06">&#34;</span> -name <span style="color:#4e9a06">&#39;*.org&#39;</span> -print0<span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::endgroup::&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># goodbye</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::notice::Pandoc conversion action ended!&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><p>Exit.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#204a87">exit</span> <span style="color:#0000cf;font-weight:bold">0</span>
</span></span></code></pre></div><h2 id="run-2">Run</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;common-variables&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;dockerfile-pandoc-co</span>nvert&gt;&gt;
</span></span></code></pre></div><p>Authentication token for github.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#204a87">read</span> -s -p <span style="color:#4e9a06">&#39;Enter token: &#39;</span> gh_token
</span></span></code></pre></div><h3 id="run-script-3">Run script</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">in_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/doc
</span></span><span style="display:flex;"><span><span style="color:#000">out_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./.doc-out&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">pandoc_clean</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>env -i <span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/org-to-md.sh <span style="color:#4e9a06">&#34;</span><span style="color:#000">$in_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$out_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$pandoc_clean</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>env -i <span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000">LIVE_OR_DIE</span><span style="color:#ce5c00;font-weight:bold">=</span>live <span style="color:#000">GH_MODE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/org-to-md.sh <span style="color:#4e9a06">&#34;</span><span style="color:#000">$in_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$out_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$pandoc_clean</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h3 id="run-docker-3">Run docker</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">work_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/github/workspace&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">script</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span>/src/org-to-md.sh
</span></span><span style="display:flex;"><span><span style="color:#000">in_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;doc&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">out_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./.doc-out&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">pandoc_clean</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker run -it --rm --name shwrap-pandoc-convert <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       --volume <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>:<span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       -eLIVE_DEBUG<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$in_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$out_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$pandoc_clean</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker run -it --rm --name shwrap-pandoc-convert <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       --volume <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>:<span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       -eLIVE_DEBUG<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> -eLIVE_OR_DIE<span style="color:#ce5c00;font-weight:bold">=</span>live -eGH_MODE<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$in_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$out_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$pandoc_clean</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h3 id="run-action-2">Run action</h3>
<h4 id="template-1">Template</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.json" data-lang="{.json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${REF}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;inputs&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;run_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${RUN_ID}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;payload&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;dockerfile_template&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${DOCKERFILE_TEMPLATE}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;dockerfile&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${DOCKERFILE}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;work_dir&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${WORK_DIR}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;script&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${SCRIPT}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;in_dir&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${IN_DIR}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;out_dir&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${OUT_DIR}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;pandoc_clean&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${PANDOC_CLEAN}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;out_cache&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${OUT_CACHE}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;out_cache_dir&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${OUT_CACHE_DIR}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="data-1">Data</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#8f5902;font-style:italic"># shellcheck disable=SC2034</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">WORKFLOW_ID</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;39688674&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">REF</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;actions&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">RUN_ID</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;pandoc-convert/01/01&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">DOCKERFILE_TEMPLATE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./_actions/docker/pandoc-convert.Dockerfile&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">DOCKERFILE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;pandoc-convert.Dockerfile&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">WORK_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/github/workspace&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">SCRIPT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./_actions/src/org-to-md.sh&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">IN_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./test/pandoc-convert&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">OUT_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./.doc-out&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">PANDOC_CLEAN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">OUT_CACHE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;pandoc-convert-01-01&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">OUT_CACHE_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./.doc-out&#34;</span>
</span></span></code></pre></div><h4 id="test-1">Test</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">GITHUB_REPO</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;ekotik/sh.wrap&#34;</span>
</span></span><span style="display:flex;"><span>env <span style="color:#000">GITHUB_TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/workflow/test-workflows.sh <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">GITHUB_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/workflow/data/pandoc-convert
</span></span></code></pre></div><h1 id="docker-image-for-documentation-site-generation">Docker image for documentation site generation</h1>
<h2 id="build-docker-image-3">Build docker image</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&lt;&lt;common-variables&gt;&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>DOCKERFILE_TEMPLATE=&#34;${DOCKERFILES_PATH}&#34;/hugo-site.Dockerfile
</span></span><span style="display:flex;"><span>DOCKER_IMAGE=&#34;shwrap:hugo-site&#34;
</span></span><span style="display:flex;"><span>DOCKER_PATH=&#34;${DOCKER_PATH}&#34;
</span></span><span style="display:flex;"><span>DOCKERFILE=&#34;${DOCKER_PATH}&#34;/hugo-site.Dockerfile
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>FROM ubuntu:latest as build
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>RUN apt update &amp;&amp; apt install --yes ca-certificates
</span></span><span style="display:flex;"><span>RUN apt install --yes bash
</span></span><span style="display:flex;"><span>RUN apt install --yes curl
</span></span><span style="display:flex;"><span>RUN apt install --yes git
</span></span><span style="display:flex;"><span>RUN apt install --yes golang
</span></span><span style="display:flex;"><span>RUN mkdir /go
</span></span><span style="display:flex;"><span>COPY &#34;${HUGO_BIN_SOURCE}&#34; &#34;${HUGO_BIN_DEST}&#34;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FROM build as hugo-site
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>COPY &#34;${DOCKERFILE_SCRIPTS_PATH}&#34;/entrypoint.sh /entrypoint.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ENTRYPOINT [&#34;bash&#34;, &#34;/entrypoint.sh&#34;]
</span></span><span style="display:flex;"><span>CMD [&#34;${WORK_DIR}&#34;, &#34;${SCRIPT}&#34;, &#34;${HUGO_BIN_DEST}&#34;, &#34;${DOCS_DIR}&#34;, &#34;${SITE_DIR}&#34;, &#34;${PUBLIC_DIR}&#34;]
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>env -i <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    <span style="color:#000">DOCKERFILES_PATH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILES_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    <span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    <span style="color:#000">HUGO_BIN_SOURCE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./docker/hugo/hugo&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    <span style="color:#000">HUGO_BIN_DEST</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/go/hugo&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/dockerfile.sh <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_TEMPLATE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker build -t <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> -f <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> --no-cache
</span></span><span style="display:flex;"><span>docker tag <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><p>Push to Docker Hub (optionally).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker push <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h2 id="hugo-site">Hugo site</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#000">LIVE_OR_DIE</span><span style="color:#ce5c00;font-weight:bold">=</span>live
</span></span><span style="display:flex;"><span><span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;preamble&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;op</span>tions&gt;&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;optio</span>ns-debug&gt;&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;help&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;live-or-die-trap&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;gh</span>-mode&gt;&gt;
</span></span></code></pre></div><p>Help.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>help-hugo-site() {
</span></span><span style="display:flex;"><span>    printf &#34;Usage: %s: &lt;HUGOPATH&gt; &lt;DOCSDIR&gt; &lt;SITEDIR&gt; &lt;PUBLICDIR&gt;\n&#34; &#34;$0&#34;
</span></span><span style="display:flex;"><span>    help &#34;$@&#34;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># greetings for github runner</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::notice::Hugo site action started!&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><p>Set up parameters.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#000">hugo_bin</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/hugo/hugo
</span></span><span style="display:flex;"><span><span style="color:#000">docs_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/hugo-site
</span></span><span style="display:flex;"><span><span style="color:#000">site_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$docs_dir</span><span style="color:#4e9a06">&#34;</span>/site
</span></span><span style="display:flex;"><span><span style="color:#000">public_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$site_dir</span><span style="color:#4e9a06">&#34;</span>/public
</span></span></code></pre></div><p>Check parameters.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span># check parameters
</span></span><span style="display:flex;"><span>if [[ $# -eq 0 ]]; then
</span></span><span style="display:flex;"><span>    echo &gt;&amp;2 &#34;No hugo binary path specified&#34;
</span></span><span style="display:flex;"><span>    help-hugo-site &#34;$@&#34;
</span></span><span style="display:flex;"><span>fi
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>if [[ $# -eq 1 ]]; then
</span></span><span style="display:flex;"><span>    echo &gt;&amp;2 &#34;No documentation directory specified&#34;
</span></span><span style="display:flex;"><span>    help-hugo-site &#34;$@&#34;
</span></span><span style="display:flex;"><span>fi
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>if [[ $# -eq 2 ]]; then
</span></span><span style="display:flex;"><span>    echo &gt;&amp;2 &#34;No site directory specified&#34;
</span></span><span style="display:flex;"><span>    help-hugo-site &#34;$@&#34;
</span></span><span style="display:flex;"><span>fi
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>if [[ $# -eq 3 ]]; then
</span></span><span style="display:flex;"><span>    echo &gt;&amp;2 &#34;No publish directory specified&#34;
</span></span><span style="display:flex;"><span>    help-hugo-site &#34;$@&#34;
</span></span><span style="display:flex;"><span>fi
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>hugo_bin=$(realpath &#34;$1&#34;)
</span></span><span style="display:flex;"><span>docs_dir=$(realpath &#34;$2&#34;)
</span></span><span style="display:flex;"><span>site_dir=$(realpath &#34;$3&#34;)
</span></span><span style="display:flex;"><span>public_dir=$(realpath &#34;$4&#34;)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># check paths</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;hugo binary not found&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[[</span> -f <span style="color:#4e9a06">&#34;</span><span style="color:#000">$hugo_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;documentation directory not found&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[[</span> -d <span style="color:#4e9a06">&#34;</span><span style="color:#000">$site_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span></code></pre></div><p>Hugo run.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># generate documentation</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::group::Generate hugo site&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># hugo run</span>
</span></span><span style="display:flex;"><span>chmod u+x <span style="color:#4e9a06">&#34;</span><span style="color:#000">$hugo_bin</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">{</span> <span style="color:#204a87">pushd</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$site_dir</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$hugo_bin</span><span style="color:#4e9a06">&#34;</span> mod get -u<span style="color:#000;font-weight:bold">;</span> popd<span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$hugo_bin</span><span style="color:#4e9a06">&#34;</span> -c <span style="color:#4e9a06">&#34;</span><span style="color:#000">$docs_dir</span><span style="color:#4e9a06">&#34;</span> -s <span style="color:#4e9a06">&#34;</span><span style="color:#000">$site_dir</span><span style="color:#4e9a06">&#34;</span> -d <span style="color:#4e9a06">&#34;</span><span style="color:#000">$public_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::endgroup::&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># goodbye</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::notice::Hugo site action ended!&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><h3 id="docsy-site">Docsy site</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>&lt;&lt;common-variables&gt;&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#000">LIVE_OR_DIE</span><span style="color:#ce5c00;font-weight:bold">=</span>live
</span></span><span style="display:flex;"><span><span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;preamble&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;op</span>tions&gt;&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;optio</span>ns-debug&gt;&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;help&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;live-or-die-trap&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;gh</span>-mode&gt;&gt;
</span></span></code></pre></div><p>Help.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>help-docsy-site<span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">printf</span> <span style="color:#4e9a06">&#34;Usage: %s: &lt;HUGOPATH&gt; &lt;DOCSDIR&gt; &lt;SITEDIR&gt; &lt;PUBLICDIR&gt;\n&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$0</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">help</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;help-h</span>ugo-site&gt;&gt;
</span></span></code></pre></div><p>echo '::notice::Docsy site export started!' | gh_echo</p>
<p>Set up parameters.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#000">hugo_bin</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/hugo/hugo
</span></span><span style="display:flex;"><span><span style="color:#000">docs_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/docsy-site
</span></span><span style="display:flex;"><span><span style="color:#000">site_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$docs_dir</span><span style="color:#4e9a06">&#34;</span>/site
</span></span><span style="display:flex;"><span><span style="color:#000">public_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$site_dir</span><span style="color:#4e9a06">&#34;</span>/public
</span></span></code></pre></div><p>Check parameters.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># check parameters</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#000">$#</span> -eq <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> &gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">&#34;No arguments specified&#34;</span>
</span></span><span style="display:flex;"><span>    help-docsy-site <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;chec</span>k-hugo-site&gt;&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;docsy site export failed&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::group::Install docsy theme dependencies&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span><span style="display:flex;"><span>nvm <span style="color:#000;font-weight:bold">&amp;</span>&gt; /dev/null <span style="color:#ce5c00;font-weight:bold">||</span> git clone --depth<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> -b v0.39.2 https://github.com/nvm-sh/nvm ~/.nvm <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># shellcheck disable=SC1090</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">source</span> ~/.nvm/nvm.sh
</span></span><span style="display:flex;"><span>nvm use <span style="color:#0000cf;font-weight:bold">18</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#ce5c00;font-weight:bold">{</span> nvm install 18<span style="color:#000;font-weight:bold">;</span> nvm use 18<span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># get npm modules</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">pushd</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">site_dir</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/themes/docsy
</span></span><span style="display:flex;"><span>npm install <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">popd</span>
</span></span><span style="display:flex;"><span>npm install --save-dev autoprefixer postcss-cli postcss <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::endgroup::&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><p>Run generation script.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">NODE_PATH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>realpath <span style="color:#4e9a06">&#34;./node_modules&#34;</span><span style="color:#204a87;font-weight:bold">)</span> bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/hugo-site.sh <span style="color:#4e9a06">&#34;</span><span style="color:#000">$hugo_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$docs_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$site_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$public_dir</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># goodbye</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::notice::Docsy site export ended!&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><h2 id="run-3">Run</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;common-variables&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;doc</span>kerfile-hugo-site&gt;&gt;
</span></span></code></pre></div><p>Authentication token for github.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#204a87">read</span> -s -p <span style="color:#4e9a06">&#39;Enter token: &#39;</span> gh_token
</span></span></code></pre></div><h3 id="run-script-4">Run script</h3>
<h4 id="hugo">Hugo</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">hugo_bin</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/hugo/hugo
</span></span><span style="display:flex;"><span><span style="color:#000">docs_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/hugo-site/site/content
</span></span><span style="display:flex;"><span><span style="color:#000">site_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/hugo-site/site
</span></span><span style="display:flex;"><span><span style="color:#000">public_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$site_dir</span><span style="color:#4e9a06">&#34;</span>/public
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>env -i <span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/hugo-site.sh <span style="color:#4e9a06">&#34;</span><span style="color:#000">$hugo_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$docs_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$site_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$public_dir</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>env -i <span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000">LIVE_OR_DIE</span><span style="color:#ce5c00;font-weight:bold">=</span>live <span style="color:#000">GH_MODE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/hugo-site.sh <span style="color:#4e9a06">&#34;</span><span style="color:#000">$hugo_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$docs_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$site_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$public_dir</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h4 id="docsy">Docsy</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">hugo_bin</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/hugo/hugo
</span></span><span style="display:flex;"><span><span style="color:#000">docs_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/docsy-site/site/content
</span></span><span style="display:flex;"><span><span style="color:#000">site_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/docsy-site/site
</span></span><span style="display:flex;"><span><span style="color:#000">public_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$site_dir</span><span style="color:#4e9a06">&#34;</span>/public
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>env -i <span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/docsy-site.sh <span style="color:#4e9a06">&#34;</span><span style="color:#000">$hugo_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$docs_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$site_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$public_dir</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>env -i <span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000">LIVE_OR_DIE</span><span style="color:#ce5c00;font-weight:bold">=</span>live <span style="color:#000">GH_MODE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/docsy-site.sh <span style="color:#4e9a06">&#34;</span><span style="color:#000">$hugo_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$docs_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$site_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$public_dir</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h3 id="run-docker-4">Run docker</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">work_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/github/workspace&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">script</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span>/src/hugo-site.sh
</span></span><span style="display:flex;"><span><span style="color:#000">hugo_bin</span><span style="color:#ce5c00;font-weight:bold">=</span>/go/hugo
</span></span><span style="display:flex;"><span><span style="color:#000">hugo_docs_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span>/test/hugo-site/site/content
</span></span><span style="display:flex;"><span><span style="color:#000">hugo_site_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span>/test/hugo-site/site
</span></span><span style="display:flex;"><span><span style="color:#000">hugo_public_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$hugo_site_dir</span><span style="color:#4e9a06">&#34;</span>/public
</span></span><span style="display:flex;"><span><span style="color:#000">docsy_docs_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span>/test/docsy-site/site/content
</span></span><span style="display:flex;"><span><span style="color:#000">docsy_site_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span>/test/docsy-site/site
</span></span><span style="display:flex;"><span><span style="color:#000">docsy_public_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$docsy_site_dir</span><span style="color:#4e9a06">&#34;</span>/public
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker run -it --rm --name shwrap-hugo-site <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       --volume <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>:<span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       -eLIVE_DEBUG<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$hugo_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$hugo_docs_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$hugo_site_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$hugo_public_dir</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker run -it --rm --name shwrap-hugo-site <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       --volume <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>:<span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       -eLIVE_DEBUG<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> -eLIVE_OR_DIE<span style="color:#ce5c00;font-weight:bold">=</span>live -eGH_MODE<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$hugo_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$docsy_docs_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$docsy_site_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$docsy_public_dir</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h3 id="run-action-3">Run action</h3>
<h4 id="template-2">Template</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.json" data-lang="{.json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${REF}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;inputs&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;run_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${RUN_ID}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;payload&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;dockerfile_template&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${DOCKERFILE_TEMPLATE}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;dockerfile&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${DOCKERFILE}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;work_dir&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${WORK_DIR}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;script&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${SCRIPT}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;hugo_bin_source&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${HUGO_BIN_SOURCE}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;hugo_bin_dest&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${HUGO_BIN_DEST}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;hugo_bin_path&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${HUGO_BIN_PATH}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;hugo_repo&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${HUGO_REPO}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;hugo_hash&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${HUGO_HASH}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;hugo_build_args&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${HUGO_BUILD_ARGS}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;docs_dir&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${DOCS_DIR}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;site_dir&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${SITE_DIR}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;public_dir&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${PUBLIC_DIR}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;public_cache&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${PUBLIC_CACHE}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><h4 id="data-2">Data</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#8f5902;font-style:italic"># shellcheck disable=SC2034</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">WORKFLOW_ID</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;38942441&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">REF</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;actions&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">RUN_ID</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;hugo-site/01/01&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">DOCKERFILE_TEMPLATE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./_actions/docker/hugo-site.Dockerfile&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">DOCKERFILE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;hugo-site.Dockerfile&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">WORK_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/github/workspace&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">SCRIPT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./_actions/src/hugo-site.sh&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">HUGO_BIN_SOURCE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./hugo/hugo&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">HUGO_BIN_DEST</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/go/hugo&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">HUGO_BIN_PATH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./hugo&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">HUGO_REPO</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/gohugoio/hugo&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">HUGO_HASH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;bfebd8c02cfc0d4e4786e0f64932d832d3976e92&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">HUGO_BUILD_ARGS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;--tags\\nextended&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">DOCS_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./test/hugo-site/site/content&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">SITE_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./test/hugo-site/site&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">PUBLIC_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./_actions/public&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">PUBLIC_CACHE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;hugo-site-01-01&#34;</span>
</span></span></code></pre></div><h4 id="test-2">Test</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">GITHUB_REPO</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;ekotik/sh.wrap&#34;</span>
</span></span><span style="display:flex;"><span>env <span style="color:#000">GITHUB_TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/workflow/test-workflows.sh <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">GITHUB_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/workflow/data/hugo-site
</span></span></code></pre></div><h1 id="docker-image-for-git-tasks">Docker image for git tasks</h1>
<h2 id="build-docker-image-4">Build docker image</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&lt;&lt;common-variables&gt;&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>DOCKERFILE_TEMPLATE=&#34;${DOCKERFILES_PATH}&#34;/git-tasks.Dockerfile
</span></span><span style="display:flex;"><span>DOCKER_IMAGE=&#34;shwrap:git-tasks&#34;
</span></span><span style="display:flex;"><span>DOCKER_PATH=&#34;${DOCKER_PATH}&#34;
</span></span><span style="display:flex;"><span>DOCKERFILE=&#34;${DOCKER_PATH}&#34;/git-tasks.Dockerfile
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>FROM ubuntu:latest as build
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>RUN apt update &amp;&amp; apt install --yes ca-certificates
</span></span><span style="display:flex;"><span>RUN apt install --yes bash
</span></span><span style="display:flex;"><span>RUN apt install --yes curl
</span></span><span style="display:flex;"><span>RUN apt install --yes gettext
</span></span><span style="display:flex;"><span>RUN apt install --yes git
</span></span><span style="display:flex;"><span>RUN apt install --yes jq
</span></span><span style="display:flex;"><span>RUN mkdir /go
</span></span><span style="display:flex;"><span>COPY &#34;${GH_BIN_SOURCE}&#34; &#34;${GH_BIN_DEST}&#34;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FROM build as git-tasks
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>COPY &#34;${DOCKERFILE_SCRIPTS_PATH}&#34;/entrypoint.sh /entrypoint.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ENTRYPOINT [&#34;bash&#34;, &#34;/entrypoint.sh&#34;]
</span></span><span style="display:flex;"><span>CMD [&#34;${WORK_DIR}&#34;, &#34;${SCRIPT}&#34;, &#34;${GH_BIN_DEST}&#34;, &#34;${ARGS}&#34;]
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>env -i <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    <span style="color:#000">DOCKERFILES_PATH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILES_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    <span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    <span style="color:#000">GH_BIN_SOURCE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./docker/cli/bin/gh&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    <span style="color:#000">GH_BIN_DEST</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/go/gh&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/dockerfile.sh <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_TEMPLATE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker build -t <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> -f <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> --no-cache
</span></span><span style="display:flex;"><span>docker tag <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><p>Push to Docker Hub (optionally).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker push <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h2 id="git-tasks">Git tasks</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#000">LIVE_OR_DIE</span><span style="color:#ce5c00;font-weight:bold">=</span>live
</span></span><span style="display:flex;"><span><span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;preamble&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;op</span>tions&gt;&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;optio</span>ns-debug&gt;&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;help&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;live-or-die-trap&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;gh</span>-mode&gt;&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;&lt;xtrace&gt;&gt;
</span></span></code></pre></div><p>Help.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>help-git-tasks<span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">printf</span> <span style="color:#4e9a06">&#34;Usage: %s: &lt;GHPATH&gt; &lt;GITREPO&gt; &lt;GITBRANCH&gt; [COMMANDS]\n&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$0</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">help</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::notice::Git tasks action started!&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><p>Set up parameters.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#000">gh_bin</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/cli/bin/gh
</span></span><span style="display:flex;"><span><span style="color:#000">git_repo</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/ekotik/sh.wrap.git&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_branch</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;gh-pages/test&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_commands</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;git status
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">git log&#34;</span>
</span></span></code></pre></div><p>Check parameters.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># check parameters</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#000">$#</span> -eq <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> &gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">&#34;No gh binary path specified&#34;</span>
</span></span><span style="display:flex;"><span>    help-git-tasks <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#000">$#</span> -eq <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> &gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">&#34;No git repository specified&#34;</span>
</span></span><span style="display:flex;"><span>    help-git-tasks <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#000">$#</span> -eq <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> &gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">&#34;No git branch specified&#34;</span>
</span></span><span style="display:flex;"><span>    help-git-tasks <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">gh_bin</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>realpath <span style="color:#4e9a06">&#34;</span><span style="color:#000">$1</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_repo</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$2</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_branch</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$3</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">shift</span> <span style="color:#0000cf;font-weight:bold">3</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_commands</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$*</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><p>Authentication token for github.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#204a87">read</span> -s -p <span style="color:#4e9a06">&#39;Enter token: &#39;</span> gh_token
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>reset_xtrace
</span></span><span style="display:flex;"><span><span style="color:#000">gh_token</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">GITHUB_TOKEN</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>restore_xtrace
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># check paths</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;gh binary not found&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[[</span> -f <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># check token</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;authentication token is empty&#34;</span>
</span></span><span style="display:flex;"><span>reset_xtrace
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[[</span> -n <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span>restore_xtrace
</span></span></code></pre></div><p>Authenticate.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># authenticate with token</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;authentication failed&#34;</span>
</span></span><span style="display:flex;"><span>chmod u+x <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">unset</span> GITHUB_TOKEN
</span></span><span style="display:flex;"><span><span style="color:#000">GIT_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span>.nogit <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> auth login --git-protocol https --with-token <span style="color:#ce5c00;font-weight:bold">&lt;&lt;&lt;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span><span style="color:#000">GIT_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span>.nogit <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> auth setup-git <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::group::Git tasks&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><p>Run git tasks (on push on workflow_dispatch events).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># publish site</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">GITHUB_EVENT_NAME</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;push&#34;</span> <span style="color:#ce5c00;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">GITHUB_EVENT_NAME</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;workflow_dispatch&#34;</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;git clone failed&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">git_repo_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>mktemp -u -p <span style="color:#4e9a06">&#34;./&#34;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    git clone -b <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_branch</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">pushd</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo_dir</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>    git config --global --add safe.directory <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span>    git config user.name <span style="color:#4e9a06">&#34;git-tasks action&#34;</span>
</span></span><span style="display:flex;"><span>    git config user.email <span style="color:#4e9a06">&#34;nobody@nowhere&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;git tasks failed&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">git_commands_file</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>mktemp -u -p <span style="color:#4e9a06">&#34;./&#34;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> -e <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_commands</span><span style="color:#4e9a06">&#34;</span> &gt; <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_commands_file</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_commands_file</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">popd</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::endgroup::&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::notice::Git tasks action ended!&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><h2 id="gh-publish">GH publish</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#000">LIVE_OR_DIE</span><span style="color:#ce5c00;font-weight:bold">=</span>live
</span></span><span style="display:flex;"><span><span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;preamble&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;op</span>tions&gt;&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;optio</span>ns-debug&gt;&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;help&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;live-or-die-trap&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;gh</span>-mode&gt;&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;&lt;xtrace&gt;&gt;
</span></span></code></pre></div><p>Help.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>help-gh-publish<span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">printf</span> <span style="color:#4e9a06">&#34;Usage: %s: &lt;GHPATH&gt; &lt;GHPAGESREPO&gt; &lt;GHPAGESBRANCH&gt; &lt;PUBLICDIR&gt;\n&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$0</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">help</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::notice::GH publish action started!&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><p>Set up parameters.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#000">gh_bin</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/cli/bin/gh
</span></span><span style="display:flex;"><span><span style="color:#000">gh_pages_repo</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/ekotik/sh.wrap.git&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">gh_pages_branch</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;gh-pages/test&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">public_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/hugo-site/site/public
</span></span></code></pre></div><p>Check parameters.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># check parameters</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#000">$#</span> -eq <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> &gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">&#34;No gh binary path specified&#34;</span>
</span></span><span style="display:flex;"><span>    help-gh-publish <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#000">$#</span> -eq <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> &gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">&#34;No gh-pages repository specified&#34;</span>
</span></span><span style="display:flex;"><span>    help-gh-publish <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#000">$#</span> -eq <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> &gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">&#34;No gh-pages branch specified&#34;</span>
</span></span><span style="display:flex;"><span>    help-gh-publish <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#000">$#</span> -eq <span style="color:#0000cf;font-weight:bold">3</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> &gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">&#34;No publish directory specified&#34;</span>
</span></span><span style="display:flex;"><span>    help-gh-publish <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">gh_bin</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>realpath <span style="color:#4e9a06">&#34;</span><span style="color:#000">$1</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">gh_pages_repo</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$2</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">gh_pages_branch</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$3</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">public_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>realpath <span style="color:#4e9a06">&#34;</span><span style="color:#000">$4</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span></code></pre></div><p>Authentication token for github.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#204a87">read</span> -s -p <span style="color:#4e9a06">&#39;Enter token: &#39;</span> gh_token
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>reset_xtrace
</span></span><span style="display:flex;"><span><span style="color:#000">gh_token</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">GITHUB_TOKEN</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>restore_xtrace
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># check paths</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;gh binary not found&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[[</span> -f <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;publish directory not found&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[[</span> -d <span style="color:#4e9a06">&#34;</span><span style="color:#000">$public_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># check token</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;authentication token is empty&#34;</span>
</span></span><span style="display:flex;"><span>reset_xtrace
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[[</span> -n <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span>restore_xtrace
</span></span></code></pre></div><p>Authenticate.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># authenticate with token</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;authentication failed&#34;</span>
</span></span><span style="display:flex;"><span>chmod u+x <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">unset</span> GITHUB_TOKEN
</span></span><span style="display:flex;"><span><span style="color:#000">GIT_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span>.nogit <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> auth login --git-protocol https --with-token <span style="color:#ce5c00;font-weight:bold">&lt;&lt;&lt;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span><span style="color:#000">GIT_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span>.nogit <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> auth setup-git <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::group::Push site to GH pages&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><p>Publish to gh-pages (on push on workflow_dispatch events).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># publish site</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">GITHUB_EVENT_NAME</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;push&#34;</span> <span style="color:#ce5c00;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">GITHUB_EVENT_NAME</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;workflow_dispatch&#34;</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;publish site failed&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">pushd</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$public_dir</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>    git init
</span></span><span style="display:flex;"><span>    git config --global --add safe.directory <span style="color:#4e9a06">&#34;</span><span style="color:#000">$public_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span>    git config user.name <span style="color:#4e9a06">&#34;gh-publish action&#34;</span>
</span></span><span style="display:flex;"><span>    git config user.email <span style="color:#4e9a06">&#34;nobody@nowhere&#34;</span>
</span></span><span style="display:flex;"><span>    git checkout -b <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_pages_branch</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span>    git remote add -t <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_pages_branch</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;origin&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_pages_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span>    git add .
</span></span><span style="display:flex;"><span>    git commit --allow-empty -m <span style="color:#4e9a06">&#34;pages: update gh pages&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>        --author<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;gh-publish action &lt;nobody@nowhere&gt;&#34;</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span>    git push <span style="color:#4e9a06">&#34;origin&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_pages_branch</span><span style="color:#4e9a06">&#34;</span> --force <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">popd</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::endgroup::&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::notice::GH publish action ended!&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><h2 id="git-submodules-update">Git submodules update</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#000">LIVE_OR_DIE</span><span style="color:#ce5c00;font-weight:bold">=</span>live
</span></span><span style="display:flex;"><span><span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;preamble&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;op</span>tions&gt;&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;optio</span>ns-debug&gt;&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;help&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;live-or-die-trap&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;gh</span>-mode&gt;&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;&lt;xtrace&gt;&gt;
</span></span></code></pre></div><p>Help.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>help-git-submodule<span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">printf</span> <span style="color:#4e9a06">&#34;Usage: %s: &lt;GHBIN&gt; &lt;GITREPO&gt; &lt;GITBRANCH&gt; &lt;GITDIR&gt; [GITAMEND]\n&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$0</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">help</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::notice::git submodules update started!&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><p>Set up parameters.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#000">gh_bin</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/cli/bin/gh
</span></span><span style="display:flex;"><span><span style="color:#000">git_repo</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/ekotik/sh.wrap.git&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_branch</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;gh-pages/test&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_repo_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./update-submodules&#34;</span>
</span></span></code></pre></div><p>Check parameters.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># check parameters</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#000">$#</span> -eq <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> &gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">&#34;No gh binary path specified&#34;</span>
</span></span><span style="display:flex;"><span>    help-git-submodule <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#000">$#</span> -eq <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> &gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">&#34;No git repository specified&#34;</span>
</span></span><span style="display:flex;"><span>    help-git-submodule <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#000">$#</span> -eq <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> &gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">&#34;No git branch specified&#34;</span>
</span></span><span style="display:flex;"><span>    help-git-submodule <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#000">$#</span> -eq <span style="color:#0000cf;font-weight:bold">3</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">echo</span> &gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">&#34;No git path specified&#34;</span>
</span></span><span style="display:flex;"><span>    help-git-submodule <span style="color:#4e9a06">&#34;</span><span style="color:#000">$@</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">gh_bin</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>realpath <span style="color:#4e9a06">&#34;</span><span style="color:#000">$1</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_repo</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$2</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_branch</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$3</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_repo_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>realpath <span style="color:#4e9a06">&#34;</span><span style="color:#000">$4</span><span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_amend</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$5</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><p>Authentication token for github.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#204a87">read</span> -s -p <span style="color:#4e9a06">&#39;Enter token: &#39;</span> gh_token
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>reset_xtrace
</span></span><span style="display:flex;"><span><span style="color:#000">gh_token</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">GITHUB_TOKEN</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>restore_xtrace
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># check paths</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;gh binary not found&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[[</span> -f <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># check token</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;authentication token is empty&#34;</span>
</span></span><span style="display:flex;"><span>reset_xtrace
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[[</span> -n <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">]]</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span>restore_xtrace
</span></span></code></pre></div><p>Authenticate.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># authenticate with token</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;authentication failed&#34;</span>
</span></span><span style="display:flex;"><span>chmod u+x <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">unset</span> GITHUB_TOKEN
</span></span><span style="display:flex;"><span><span style="color:#000">GIT_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span>.nogit <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> auth login --git-protocol https --with-token <span style="color:#ce5c00;font-weight:bold">&lt;&lt;&lt;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span><span style="color:#000">GIT_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span>.nogit <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> auth setup-git <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::group::Update git submodules&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><p>Update git submodules.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># update git submodules</span>
</span></span><span style="display:flex;"><span><span style="color:#000">LAST_ERROR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;git submodules update failed&#34;</span>
</span></span><span style="display:flex;"><span>git clone -b <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_branch</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">pushd</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo_dir</span><span style="color:#4e9a06">&#34;</span>
</span></span><span style="display:flex;"><span>git config --global --add safe.directory <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span>git config user.name <span style="color:#4e9a06">&#34;git-submodule action&#34;</span>
</span></span><span style="display:flex;"><span>git config user.email <span style="color:#4e9a06">&#34;nobody@nowhere&#34;</span>
</span></span><span style="display:flex;"><span>git submodule update --init --force --remote --recursive
</span></span><span style="display:flex;"><span>git add .
</span></span><span style="display:flex;"><span>git commit <span style="color:#4e9a06">${</span><span style="color:#000">git_amend</span><span style="color:#000;font-weight:bold">:+--amend</span><span style="color:#4e9a06">}</span> --allow-empty -m <span style="color:#4e9a06">&#34;actions: update git submodules&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    --author<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;git-submodule action &lt;nobody@nowhere&gt;&#34;</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">$live_or_die</span>
</span></span><span style="display:flex;"><span>git push <span style="color:#4e9a06">&#34;origin&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_branch</span><span style="color:#4e9a06">&#34;</span> --force
</span></span><span style="display:flex;"><span><span style="color:#204a87">popd</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::endgroup::&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#39;::notice::git submodules update ended!&#39;</span> <span style="color:#000;font-weight:bold">|</span> gh_echo
</span></span></code></pre></div><h2 id="run-4">Run</h2>
<p>Authentication token for github.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#204a87">read</span> -s -p <span style="color:#4e9a06">&#39;Enter token: &#39;</span> gh_token
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;common-variables&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;doc</span>kerfile-git-tasks&gt;&gt;
</span></span></code></pre></div><h3 id="run-git-tasks">Run git tasks</h3>
<h4 id="run-script-5">Run script</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">gh_bin</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/cli/bin/gh
</span></span><span style="display:flex;"><span><span style="color:#000">git_repo</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/ekotik/sh.wrap.git&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_branch</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;gh-pages/test&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_commands</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;git status
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">git log&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>env <span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000">GITHUB_TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> <span style="color:#000">GITHUB_EVENT_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;push&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/git-tasks.sh <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_branch</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_commands</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>env <span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000">LIVE_OR_DIE</span><span style="color:#ce5c00;font-weight:bold">=</span>live <span style="color:#000">GH_MODE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000">GITHUB_TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> <span style="color:#000">GITHUB_EVENT_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;push&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/git-tasks.sh <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_branch</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_commands</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h4 id="run-docker-5">Run docker</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">work_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/github/workspace&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">script</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span>/src/git-tasks.sh
</span></span><span style="display:flex;"><span><span style="color:#000">gh_bin</span><span style="color:#ce5c00;font-weight:bold">=</span>/go/gh
</span></span><span style="display:flex;"><span><span style="color:#000">git_repo</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/ekotik/sh.wrap.git&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_branch</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;gh-pages/test&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_commands</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;git status
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">git log&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker run -it --rm --name shwrap-git-tasks <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       --volume <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>:<span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       -eLIVE_DEBUG<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> -eGITHUB_TOKEN<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> -eGITHUB_EVENT_NAME<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;push&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_branch</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_commands</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker run -it --rm --name shwrap-git-tasks <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       --volume <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>:<span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       -eLIVE_DEBUG<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> -eLIVE_OR_DIE<span style="color:#ce5c00;font-weight:bold">=</span>live -eGH_MODE<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> -eGITHUB_TOKEN<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> -eGITHUB_EVENT_NAME<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;push&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_branch</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_commands</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h4 id="run-action-4">Run action</h4>
<ol>
<li>
<p>Template</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.json" data-lang="{.json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${REF}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;inputs&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;run_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${RUN_ID}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;payload&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;dockerfile_template&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${DOCKERFILE_TEMPLATE}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;dockerfile&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${DOCKERFILE}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;work_dir&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${WORK_DIR}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;script&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${SCRIPT}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;gh_bin_source&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GH_BIN_SOURCE}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;gh_bin_dest&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GH_BIN_DEST}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;gh_bin_path&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GH_BIN_PATH}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;gh_repo&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GH_REPO}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;gh_hash&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GH_HASH}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;gh_build_args&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GH_BUILD_ARGS}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;git_repo&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GIT_REPO}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;git_branch&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GIT_BRANCH}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;git_commands&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GIT_COMMANDS}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div></li>
<li>
<p>Data</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#8f5902;font-style:italic"># shellcheck disable=SC2034</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">WORKFLOW_ID</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;39712949&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">REF</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;actions&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">RUN_ID</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;git-tasks/01/01&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">DOCKERFILE_TEMPLATE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./_actions/docker/git-tasks.Dockerfile&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">DOCKERFILE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;git-tasks.Dockerfile&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">WORK_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/github/workspace&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">SCRIPT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./_actions/src/git-tasks.sh&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GH_BIN_SOURCE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./cli/bin/gh&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GH_BIN_DEST</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/go/gh&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GH_BIN_PATH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./cli/bin&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GH_REPO</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/cli/cli&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GH_HASH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;7d71f807c48600d0d8d9f393ef13387504987f1d&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GH_BUILD_ARGS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GIT_REPO</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/ekotik/sh.wrap&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GIT_BRANCH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;gh-pages/test&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GIT_COMMANDS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;git status\\ngit log&#34;</span>
</span></span></code></pre></div></li>
<li>
<p>Test</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">GITHUB_REPO</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;ekotik/sh.wrap&#34;</span>
</span></span><span style="display:flex;"><span>env <span style="color:#000">GITHUB_TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/workflow/test-workflows.sh <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">GITHUB_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/workflow/data/git-tasks
</span></span></code></pre></div></li>
</ol>
<h3 id="run-gh-publish">Run gh publish</h3>
<h4 id="run-script-6">Run script</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">gh_bin</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/cli/bin/gh
</span></span><span style="display:flex;"><span><span style="color:#000">gh_pages_repo</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/ekotik/sh.wrap.git&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">gh_pages_branch</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;gh-pages/test&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">public_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/hugo-site/site/public
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>env <span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000">GITHUB_TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> <span style="color:#000">GITHUB_EVENT_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;push&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/gh-publish.sh <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_pages_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_pages_branch</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$public_dir</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>env <span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000">LIVE_OR_DIE</span><span style="color:#ce5c00;font-weight:bold">=</span>live <span style="color:#000">GH_MODE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000">GITHUB_TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> <span style="color:#000">GITHUB_EVENT_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;push&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/gh-publish.sh <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_pages_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_pages_branch</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$public_dir</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h4 id="run-docker-6">Run docker</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">work_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/github/workspace&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">script</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span>/src/gh-publish.sh
</span></span><span style="display:flex;"><span><span style="color:#000">gh_bin</span><span style="color:#ce5c00;font-weight:bold">=</span>/go/gh
</span></span><span style="display:flex;"><span><span style="color:#000">gh_repo</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/ekotik/sh.wrap.git&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">gh_branch</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;gh-pages/test&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">public_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span>/test/hugo-site/site/public
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker run -it --rm --name shwrap-gh-publish <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       --volume <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>:<span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       -eLIVE_DEBUG<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> -eGITHUB_TOKEN<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> -eGITHUB_EVENT_NAME<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;push&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_branch</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$public_dir</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker run -it --rm --name shwrap-gh-publish <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       --volume <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>:<span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       -eLIVE_DEBUG<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> -eLIVE_OR_DIE<span style="color:#ce5c00;font-weight:bold">=</span>live -eGH_MODE<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> -eGITHUB_TOKEN<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> -eGITHUB_EVENT_NAME<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;push&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_branch</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$public_dir</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h4 id="run-action-5">Run action</h4>
<ol>
<li>
<p>Template</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.json" data-lang="{.json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${REF}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;inputs&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;run_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${RUN_ID}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;payload&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;dockerfile_template&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${DOCKERFILE_TEMPLATE}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;dockerfile&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${DOCKERFILE}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;work_dir&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${WORK_DIR}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;script&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${SCRIPT}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;gh_bin_source&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GH_BIN_SOURCE}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;gh_bin_dest&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GH_BIN_DEST}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;gh_bin_path&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GH_BIN_PATH}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;gh_repo&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GH_REPO}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;gh_hash&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GH_HASH}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;gh_build_args&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GH_BUILD_ARGS}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;gh_pages_repo&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GH_PAGES_REPO}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;gh_pages_branch&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GH_PAGES_BRANCH}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;public_dir&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${PUBLIC_DIR}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;public_cache&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${PUBLIC_CACHE}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div></li>
<li>
<p>Data</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#8f5902;font-style:italic"># shellcheck disable=SC2034</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">WORKFLOW_ID</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;38942442&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">REF</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;actions&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">RUN_ID</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;gh-publish/01/01&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">DOCKERFILE_TEMPLATE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./_actions/docker/git-tasks.Dockerfile&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">DOCKERFILE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;git-tasks.Dockerfile&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">WORK_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/github/workspace&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">SCRIPT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./_actions/src/gh-publish.sh&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GH_BIN_SOURCE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./cli/bin/gh&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GH_BIN_DEST</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/go/gh&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GH_BIN_PATH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./cli/bin&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GH_REPO</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/cli/cli&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GH_HASH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;7d71f807c48600d0d8d9f393ef13387504987f1d&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GH_BUILD_ARGS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GH_PAGES_REPO</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/ekotik/sh.wrap&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GH_PAGES_BRANCH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;gh-pages/test&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">PUBLIC_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./_actions/public&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">PUBLIC_CACHE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;gh-publish-01-01&#34;</span>
</span></span></code></pre></div></li>
<li>
<p>Test</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">GITHUB_REPO</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;ekotik/sh.wrap&#34;</span>
</span></span><span style="display:flex;"><span>env <span style="color:#000">GITHUB_TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/workflow/test-workflows.sh <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">GITHUB_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/workflow/data/gh-publish
</span></span></code></pre></div></li>
</ol>
<h3 id="run-git-submodules-update">Run git submodules update</h3>
<h4 id="run-script-7">Run script</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#+begin_src bash :tangle no</span>
</span></span><span style="display:flex;"><span><span style="color:#000">gh_bin</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>realpath <span style="color:#204a87;font-weight:bold">$(</span>which gh<span style="color:#204a87;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_repo</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/ekotik/ekotik.github.io&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_branch</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;gh-pages/site&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_path</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./ekotik.github.io&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_amend</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;yes&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>env <span style="color:#000">LIVE_DEBUG</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000">GITHUB_TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> <span style="color:#000">GITHUB_EVENT_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;push&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/update-submodules.sh <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_branch</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_path</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_amend</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>env <span style="color:#000">LIVE_OR_DIE</span><span style="color:#ce5c00;font-weight:bold">=</span>live <span style="color:#000">GH_MODE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000">GITHUB_TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> <span style="color:#000">GITHUB_EVENT_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;push&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKERFILE_SCRIPTS_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/update-submodules.sh <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_branch</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_path</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_amend</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h4 id="run-docker-7">Run docker</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;common-variables&gt;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&lt;&lt;doc</span>kerfile-git-tasks&gt;&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">work_dir</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/github/workspace&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">script</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span>/src/update-submodules.sh
</span></span><span style="display:flex;"><span><span style="color:#000">gh_bin</span><span style="color:#ce5c00;font-weight:bold">=</span>/go/gh
</span></span><span style="display:flex;"><span><span style="color:#000">git_repo</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/ekotik/ekotik.github.io&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_branch</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;gh-pages/site&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_path</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./ekotik.github.io&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">git_amend</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;yes&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker run -it --rm --name shwrap-git-submodule <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       --volume <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>:<span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       -eLIVE_DEBUG<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> -eGITHUB_TOKEN<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> -eGITHUB_EVENT_NAME<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;push&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_branch</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_path</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_amend</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span>docker run -it --rm --name shwrap-git-submodule <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       --volume <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>:<span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       -eLIVE_DEBUG<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> -eLIVE_OR_DIE<span style="color:#ce5c00;font-weight:bold">=</span>live -eGH_MODE<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span> -eGITHUB_TOKEN<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> -eGITHUB_EVENT_NAME<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;push&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/<span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">DOCKER_IMAGE</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>       <span style="color:#4e9a06">&#34;</span><span style="color:#000">$work_dir</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$script</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_bin</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_repo</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_branch</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_path</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$git_amend</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h4 id="run-action-6">Run action</h4>
<ol>
<li>
<p>Template</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.json" data-lang="{.json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;ref&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${REF}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">&#34;inputs&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;run_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${RUN_ID}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;payload&#34;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;dockerfile_template&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${DOCKERFILE_TEMPLATE}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;dockerfile&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${DOCKERFILE}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;work_dir&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${WORK_DIR}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;script&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${SCRIPT}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;gh_bin_source&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GH_BIN_SOURCE}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;gh_bin_dest&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GH_BIN_DEST}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;gh_bin_path&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GH_BIN_PATH}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;gh_repo&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GH_REPO}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;gh_hash&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GH_HASH}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;gh_build_args&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GH_BUILD_ARGS}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;git_repo&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GIT_REPO}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;git_branch&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GIT_BRANCH}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;git_repo_dir&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GIT_REPO_DIR}&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&#34;git_amend&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;${GIT_AMEND}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div></li>
<li>
<p>Data</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-{.bash" data-lang="{.bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#8f5902;font-style:italic"># shellcheck disable=SC2034</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">WORKFLOW_ID</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;38942440&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">REF</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;actions&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">RUN_ID</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;update-submodules/01/01&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">DOCKERFILE_TEMPLATE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./_actions/docker/git-tasks.Dockerfile&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">DOCKERFILE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;git-tasks.Dockerfile&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">WORK_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/github/workspace/_actions&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">SCRIPT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./src/update-submodules.sh&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GH_BIN_SOURCE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./cli/bin/gh&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GH_BIN_DEST</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/go/gh&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GH_BIN_PATH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;./cli/bin&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GH_REPO</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/cli/cli&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GH_HASH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;7d71f807c48600d0d8d9f393ef13387504987f1d&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GH_BUILD_ARGS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GIT_REPO</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;https://github.com/ekotik/sh.wrap&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GIT_BRANCH</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;gh-pages/sh.wrap&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GIT_REPO_DIR</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;sh.wrap&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GIT_AMEND</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;yes&#34;</span>
</span></span></code></pre></div></li>
<li>
<p>Test</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">GITHUB_REPO</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;ekotik/sh.wrap&#34;</span>
</span></span><span style="display:flex;"><span>env <span style="color:#000">GITHUB_TOKEN</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#000">$gh_token</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>    bash <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/workflow/test-workflows.sh <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">GITHUB_REPO</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">SOURCE_PATH</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>/test/workflow/data/update-submodules
</span></span></code></pre></div></li>
</ol>

	
	
	
</div>


          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="sh.wrap" aria-label="sh.wrap">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/ekotik/sh.wrap" aria-label="sh.wrap">
      <i class="fa-brands fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2023 sh.wrap All Rights Reserved</small>
        
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    

<script src="/sh.wrap/js/main.min.b76aacc94655d38d648131c0bfd9e9a5e2ad91495630091726ea8f8d9b41ec54.js" integrity="sha256-t2qsyUZV041kgTHAv9nppeKtkUlWMAkXJuqPjZtB7FQ=" crossorigin="anonymous"></script>
<script src='/sh.wrap/js/tabpane-persist.js'></script>

  </body>
</html>